#!/bin/sh

set -e -x

MAKE=make
MAKEFILE=Makefile

#----- Need gmake on AIX
if [[ $HOSTTYPE = "AIX" ]]; then
   MAKE=gmake
fi

#----- Reset __TIMESTAMP__
touch src/App.c

#----- Build no multi processor version first
unset OMPI
$MAKE -f $MAKEFILE clear
$MAKE -f $MAKEFILE  all

#----- Build OpenMP/MPI lib only
export OMPI=-ompi
$MAKE -f $MAKEFILE clean
$MAKE -f $MAKEFILE lib

while [ "$1" != "" ]; do
    if [ "$1" == "-ssm" ]; then
        $MAKE -f $MAKEFILE ssm
    elif [ "$1" == "-install" ]; then
        $MAKE -f $MAKEFILE install
    fi
    shift
done

